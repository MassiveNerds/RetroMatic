<div class="page-container mat-typography">
  <div class="primary-header">
    <h1>{{ retroboard?.name }}</h1>
  </div>
  <div fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="5px">
    <mat-card fxFlex="33%" *ngFor="let bucket of buckets | async">
      <mat-card-header>
        <mat-card-title>{{ bucket.name }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-list>
          <mat-list-item class="retro-note" *ngFor="let note of bucket.notes | async">
            <button
              color="warn"
              mat-icon-button
              *ngIf="note.votes && note.votes[uid]"
              (click)="downVote(bucket, note)">
              <mat-icon aria-hidden="true">keyboard_arrow_down</mat-icon>
            </button>
            <button
              color="accent"
              mat-icon-button
              *ngIf="!note.votes || (note.votes && !note.votes[uid])"
              (click)="upVote(bucket, note)">
              <mat-icon aria-hidden="true">keyboard_arrow_up</mat-icon>
            </button>
            <button
              id="noteButton"
              [matBadge]="note.totalVotes != 0 ? note.totalVotes : ''"
              [matBadgeHidden]="!!note.totalVotes == 0"
              mat-button
              fxFlex
              fxLayoutAlign="space-between center"
              [class.success]="bucket.type === 'success'"
              [class.danger]="bucket.type === 'danger'"
              [class.info]="bucket.type === 'info'"
              (click)="openModal(edittemplate, bucket, note)">
              {{note.message}}
            </button>
          </mat-list-item>
          <mat-list-item>
            <button
              mat-button
              fxFlex
              title="Add entry to {{bucket.name}}"
              aria-label="Add entry"
              class="add-new-button"
              [class.success]="bucket.type==='success'"
              [class.danger]="bucket.type==='danger'"
              [class.info]="bucket.type==='info'"
              (click)="openModal(addtemplate, bucket)">
              <mat-icon aria-hidden="true ">add</mat-icon>
            </button>
          </mat-list-item>
        </mat-list>
      </mat-card-content>
    </mat-card>
  </div>
  <!-- TODO: Fix this component! -->
  <!-- <exporting [jsonData]="jsonData "></exporting> -->
</div>

<ng-template #addtemplate>
  <mat-card>
    <mat-card-header fxLayout="row" fxLayoutAlign="space-between start">
      <mat-card-title>Add entry to
        <strong>{{activeBucket.name}}</strong>
      </mat-card-title>
      <button mat-icon-button mat-dialog-close>
        <mat-icon aria-label="Close">close</mat-icon>
      </button>
    </mat-card-header>
    <mat-card-content>
      <mat-form-field fxFlex>
        <textarea
          matInput
          #addmessage
          cdkFocusInitial
          cdkTextareaAutosize
          cdkAutosizeMinRows="3"></textarea>
      </mat-form-field>
    </mat-card-content>
    <mat-card-actions>
      <button mat-raised-button color="primary" (click)="addNote(addmessage.value)">Add</button>
      <button mat-button mat-dialog-close>Cancel</button>
    </mat-card-actions>
  </mat-card>
</ng-template>

<ng-template #edittemplate>
  <mat-card>
    <mat-card-header fxLayout="row" fxLayoutAlign="space-between start">
      <mat-card-title>Update entry to
        <strong>{{activeBucket.name}}</strong>
      </mat-card-title>
      <button mat-icon-button mat-dialog-close>
        <mat-icon aria-label="Close">close</mat-icon>
      </button>
    </mat-card-header>
    <mat-card-content>
      <mat-form-field fxFlex>
        <textarea
          matInput
          #editmessage
          cdkTextareaAutosize
          cdkAutosizeMinRows="3"
          cdkFocusInitial
          [value]="activeNote.message"></textarea>
      </mat-form-field>
    </mat-card-content>
    <mat-card-actions>
      <button mat-raised-button color="primary" (click)="updateNote(editmessage.value) ">Update</button>
      <button mat-raised-button color="warn" (click)="deleteNote() ">Delete</button>
      <button mat-button mat-dialog-close>Cancel</button>
      <button mat-stroked-button *ngIf="!activeNote.votes || (activeNote.votes && !activeNote.votes[uid]) " (click)="upVote() ">Vote up</button>
      <button mat-stroked-button *ngIf="activeNote.votes && activeNote.votes[uid]" (click)="downVote() ">Down vote</button>
    </mat-card-actions>
  </mat-card>
</ng-template>
